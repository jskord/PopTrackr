YUI.add("q-ParametricCurveRenderer",function(w){var N=w.namespace("IXL"),k=require("ixl/content/util/math/geo/GeometryUtils"),L={};function I(e,r,t,i,a){var n=e.x,o=e.y;return r<=n&&n<=t&&i<=o&&o<=a}function E(e,r,t,i,a,n){var o=e.x,s=e.y,d=Math.abs;return(d(o-r)<=n||d(o-t)<=n)&&i-n<=s&&s<=a+n||(d(s-i)<=n||d(s-a)<=n)&&r-n<=o&&o<=t+n}function O(e,r,t,i){var a=r.pointAt(t);if(isNaN(a.x)||isNaN(a.y))for(var n=1;isNaN(a.x)||isNaN(a.y);)if(t=n%2?t+n*i:t-n*i,a=r.pointAt(t),10<++n)throw new Error("could not find valid point around "+t);e.p=a,e.t=t}function T(e,r,t,i,a,n,o,s,d,l){var c=n-l,u=o+l,h=s-l,p=d+l,f=t,v=i;O(e,r,(f+v)/2,a);for(var g=e.p,m=e.t,_=0;!(E(g,n,o,s,d,l)||(I(g,c,u,h,p)?f=m:v=m,O(e,r,(f+v)/2,a),m=e.t,g=e.p,10<=++_)););}N.ParametricCurveRenderer=function(e,r){N.Renderer.call(this,e,r)},w.extend(N.ParametricCurveRenderer,N.Renderer,{_render:function(e){this.renderModel.stroked&&this._makePaths(e)},_makePaths:function(e){var r,t=.75,i=e.get("width"),a=e.get("height"),n=i+t,o=a+t,s=this.data,d=[[]],l=[[]],c=[[]];N.ParametricCurveRenderer._chooseStartingSamples(d[0],l[0],c[0],s,0,i,0,a,-.75,n,-.75,o);for(var u=(l[0][0]-l[0][l[0].length-1])/1e3,h=0;h<d.length;h++){var p=d[h],f=l[h],v=c[h];for(r=1;r<p.length;){var g=p[r-1],m=p[r],_=f[r-1],S=f[r],y=v[r-1],C=v[r];O(L,s,(_+S)/2,u);var P=L.t,x=L.p,R=I(x,-.75,n,-.75,o);if(O(L,s,(_+2*S)/3,u),y&&C&&(k.distanceSquaredLinePoint(g,m,x)>.35*.35||k.distanceSquaredLinePoint(g,m,L.p)>.35*.35))p.splice(r,0,x),f.splice(r,0,P),v.splice(r,0,R);else if(y&&C)r++;else if(y){var w=p.splice(r,p.length-r),M=f.splice(r,f.length-r),A=v.splice(r,v.length-r);h===d.length-1&&(d.push(w),l.push(M),c.push(A)),T(L,s,_,S,u,0,i,0,a,t),f.push(L.t),p.push(L.p),v.push(!0)}else C?(T(L,s,S,_,u,0,i,0,a,t),f[r-1]=L.t,p[r-1]=L.p,v[r-1]=!0):g.y>o&&m.y<o||m.y>o&&g.y<o?(T(L,s,_,S,u,0,i,0,a,t),E(L.p,0,i,0,a,t)||I(L.p,0,i,0,a)?(f.splice(r,0,L.t),p.splice(r,0,L.p),v.splice(r,0,!0)):(f.splice(r-1,1),p.splice(r-1,1),v.splice(r-1,1))):(f.splice(r-1,1),p.splice(r-1,1),v.splice(r-1,1))}}this._makeGraphicPaths(e,d)},_makeGraphicPaths:function(e,r){var t=this.renderModel,i=null;function a(e,r){0===r?i.moveTo(e.x,e.y):i.lineTo(e.x,e.y)}for(var n=0;n<r.length;n++){var o=r[n],s=o.length;if(!(s<=1)&&!(2===s&&k.distanceSquared(o[0],o[1])<120)){var d={color:t.itsAboutMe?t.strokeItsAboutMe.toHexString():t.itsNotAboutMe?t.strokeItsNotAboutMe.toHexString():t.unconstructed?N.ColorUtils.intToHexColor(N.RenderModel.UNCONSTRUCTED_COLOR):t.background?N.ColorUtils.intToHexColor(N.RenderModel.BACKGROUND_COLOR):t.diagramMarker?t.markerColor.toHexString():t.stroke.toHexString(),weight:t.important||t.itsAboutMe?4:2,opacity:t.transparent?.45:1,dashstyle:t.solidDiagramMarker?"none":t.dashed||t.diagramMarker?N.Renderer.DASH_STYLE:"none"};i=e.addShape({type:"path",stroke:d}),N.Renderer.fixPathShapeBounds(i),w.Array.each(o,a),i.end(),this._drawArrow(e,d,o[1],o[0],t.arrowStart),this._drawArrow(e,d,o[s-2],o[s-1],t.arrowEnd),this._drawCircle(e,d,o[0],this.data.startEndpointOpenClosed),this._drawCircle(e,d,o[s-1],this.data.endEndpointOpenClosed)}}},_drawArrow:function(e,r,t,i,a){if(!w.Lang.isBoolean(a)){var n=i.x-t.x,o=i.y-t.y,s=i.x+n,d=i.y+o;a=s<0||d<0||s>e.get("width")||d>e.get("height")}a&&this.drawArrow(e,r,t,i)},_drawCircle:function(e,r,t,i){w.Lang.isBoolean(i)&&e.addShape({type:"circle",x:t.x-4,y:t.y-4,radius:4,fill:{color:i?"#ffffff":r.color||"#000000"},stroke:{color:r.color,weight:1,dashstyle:"none"}})}},{MIN_SAMPLES:25,_chooseStartingSamples:function(e,r,t,i,a,n,o,s,d,l,c,u){var h,p,f,v,g=0,m=i.t1,_=i.t2;w.Lang.isValue(m)||(m=i.t1=k.findBoundT(i,!1,a,n,o,s)),w.Lang.isValue(_)||(_=i.t2=k.findBoundT(i,!0,a,n,o,s));var S,y,C=(_-m)/1e3,P=N.ParametricCurveRenderer.MIN_SAMPLES,x=(_-m)/(P-1);for(h=0;h<P;h++)O(L,i,m+h*x,C),p=L.t,(v=I(f=L.p,d,l,c,u))&&g++,0<h&&N.ParametricCurveRenderer._ensureDistinctIntermediatePoints(e,r,t,i,C,d,l,c,u,S,f,y,p,0,!1),r.push(p),e.push(f),t.push(v),S=f,y=p;for(var R=0;g<N.ParametricCurveRenderer.MIN_SAMPLES-2&&!(5<++R);)for(h=e.length-1;1<=h;h--)O(L,i,(r[h-1]+r[h])/2,C),p=L.t,(v=I(f=L.p,d,l,c,u))&&g++,e.splice(h,0,f),r.splice(h,0,p),t.splice(h,0,v)},_ensureDistinctIntermediatePoints:function(e,r,t,i,a,n,o,s,d,l,c,u,h,p,f){if(5!==p){if(m=l,_=c,k.distanceSquared(m,_)<1e-4){var v=(u+h)/2;O(L,i,v,a),v=L.t;var g=L.p;N.ParametricCurveRenderer._ensureDistinctIntermediatePoints(e,r,t,i,n,o,s,d,l,g,u,v,p+1,!0),N.ParametricCurveRenderer._ensureDistinctIntermediatePoints(e,r,t,i,n,o,s,d,g,c,v,h,p+1,!1)}var m,_;f&&(e.push(c),r.push(h),t.push(I(c,n,o,s,d)))}}})},"@VERSION@",{requires:["base","node","array-extras","q-Renderer","ixl_content_util_math_geo_GeometryUtils"]});
YUI.add("q-ParametricExpressionCurveRenderer",function(e){var a=e.namespace("IXL");a.ParametricExpressionCurveRenderer=function(e,r){a.ParametricCurveRenderer.call(this,e,r)},e.extend(a.ParametricExpressionCurveRenderer,a.ParametricCurveRenderer)},"@VERSION@",{requires:["base","node","array-extras","q-ParametricCurveRenderer"]});
