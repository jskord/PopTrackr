!function(){function e(e,t,o){"use strict";var n=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}();var s=e("ixl/external/react/react"),r=e("ixl/external/react/reactDom"),i=e("ixl/external/react/prop-types"),a=e("ixl/content/util/YUA"),l=e("ixl/util-commonjs/Intl").getModule("util-StaticResources"),c={open:i.bool,closeCallback:i.func,focusCallback:i.func,blurCallback:i.func,showCloseButton:i.bool,extraClassName:i.string,extraClassNameUnderlay:i.string,minMargin:i.number,zIndex:i.number,maskClosable:i.bool,ariaLabelledBy:i.string,ariaDescribedBy:i.string},d=function(e){function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t._onResize=t._onResize.bind(t),t._onEscape=t._onEscape.bind(t),t._onFocusPopover=t._onFocusPopover.bind(t),t._onBlurPopover=t._onBlurPopover.bind(t),t._onMaskClose=t._onMaskClose.bind(t),t.forceResizePopover=t.forceResizePopover.bind(t),t._centerPopover=t._centerPopover.bind(t),t._setupTabs=t._setupTabs.bind(t),t._removeTabs=t._removeTabs.bind(t),t._controlTab=t._controlTab.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,s.Component),n(o,[{key:"render",value:function(){var e={display:this.props.open?"block":"none",zIndex:this.props.zIndex},t=null;this.props.showCloseButton&&(t=s.createElement("a",{href:"javascript:void(0)",className:"modal-close",onClick:this.props.closeCallback,role:"button","aria-label":l.getRaw("flowdialog.close")}));return s.createElement("div",{className:"ixl-modal-mask "+this.props.extraClassName,style:e,onClick:this._onMaskClose},s.createElement("div",{className:"ixl-modal",style:{},role:"dialog","aria-labelledby":this.props.ariaLabelledBy,"aria-describedby":this.props.ariaDescribedBy,onFocus:this._onFocusPopover,onBlur:this._onBlurPopover,tabIndex:-1,ref:"modal"},s.createElement("div",{className:"ixl-modal-container"},s.createElement("div",{className:"ixl-modal-inside"},s.createElement("div",{className:"ixl-modal-content",ref:"modalContent"},this.props.children)),t),s.createElement("div",{className:this.props.extraClassNameUnderlay?this.props.extraClassNameUnderlay:"ixl-modal-underlay",ref:"underlay"})))}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this._onResize),document.addEventListener("keydown",this._onEscape),this._setupTabs(),this._onResize()}},{key:"componentWillReceiveProps",value:function(e){a.ios&&11<=a.ios&&a.ios<=11.2&&(!this.props.open&&e.open?document.body.classList.add("prevent-ios-body-scroll"):this.props.open&&!e.open&&document.body.classList.remove("prevent-ios-body-scroll"))}},{key:"componentWillUpdate",value:function(){this._removeTabs()}},{key:"componentDidUpdate",value:function(){this._setupTabs(),this._onResize()}},{key:"componentWillUnmount",value:function(){this._removeTabs(),window.removeEventListener("resize",this._onResize),document.removeEventListener("keydown",this._onEscape),document.body.classList.remove("prevent-ios-body-scroll")}},{key:"_setupTabs",value:function(){var e=Array.prototype.slice.call(r.findDOMNode(this).querySelectorAll(["a","input:not([type=hidden])","select","textarea","button",".practice-audio-button:not([tabindex='-1'])"].join(","))),t=(e=e.filter(function(e){return 0<e.offsetHeight})).filter(function(e){return 0===e.tabIndex}),o=e.filter(function(e){return 0<e.tabIndex});o.sort(function(e,t){return e.tabIndex>t.tabIndex}),this._tabOrder=t.concat(o);var n=this;this._tabOrder.forEach(function(e){e.addEventListener("keydown",n._controlTab)})}},{key:"_removeTabs",value:function(){var t=this;this._tabOrder.forEach(function(e){e.removeEventListener("keydown",t._controlTab)})}},{key:"_controlTab",value:function(e){if("Tab"===e.key){e.preventDefault();var t=this._tabOrder.indexOf(e.target);e.shiftKey?t--:t++,t<0&&(t=this._tabOrder.length-1),t>=this._tabOrder.length&&(t=0),this._tabOrder[t].focus()}}},{key:"_onResize",value:function(){this.props.open&&this._centerPopover()}},{key:"_onEscape",value:function(e){this.props.open&&"Escape"===e.key&&this.props.showCloseButton&&this.props.closeCallback()}},{key:"_onFocusPopover",value:function(){this.props.focusCallback&&this.props.focusCallback()}},{key:"_onBlurPopover",value:function(){this.props.blurCallback&&this.props.blurCallback()}},{key:"_onMaskClose",value:function(e){this.props.maskClosable&&e.currentTarget===e.target&&this.props.closeCallback()}},{key:"forceResizePopover",value:function(){this._centerPopover()}},{key:"_centerPopover",value:function(){var e=document.documentElement.clientHeight,t=document.documentElement.clientWidth;this._lastHeight||(this._lastHeight=e),this._lastWidth||(this._lastWidth=t),/(android)/i.test(navigator.userAgent)&&(this._lastWidth===t&&3*this._lastHeight/4>e?this._androidKeyboardShown=!0:this._lastWidth===t&&4*this._lastHeight/3<e&&(this._androidKeyboardShown=!1)),this.refs.modalContent.style.removeProperty("height"),this.refs.modal.style.removeProperty("right"),this.refs.modal.style.removeProperty("left"),this.refs.modalContent.style.removeProperty("width");var o=this.refs.modalContent.getBoundingClientRect(),n=this.refs.underlay.getBoundingClientRect(),s=o.height,r=o.width,i=e-s,a=this.props.minMargin+(n.width-r)/2;2*a<i?(this.refs.modal.style.top=i/2+"px",this.refs.modal.style.removeProperty("bottom")):this._androidKeyboardShown?this.refs.modal.style.top=a+"px":(this.refs.modal.style.top=a+"px",this.refs.modal.style.bottom=a+"px",this.refs.modalContent.style.height=e-2*a+"px");var l=t-r;2*a<l?(this.refs.modal.style.left=l/2+"px",this.refs.modal.style.removeProperty("right")):(this.refs.modal.style.left=a+"px",this.refs.modal.style.right=a+"px",this.refs.modalContent.style.width=t-2*a+"px"),this._lastHeight=e,this._lastWidth=t}}]),o}();d.propTypes=c,d.defaultProps={open:!1,showCloseButton:!0,extraClassName:"",extraClassNameUnderlay:"",minMargin:10,zIndex:1e3,maskClosable:!1,ariaLabelledBy:"",ariaDescribedBy:""},o.exports=d}e.moduleId="ixl_product-components_IxlModal",define(e)}();
